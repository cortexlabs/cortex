sudo: required

language: go
go: "1.11.5"

services:
  - docker

jobs:
  include:
    - stage: files
      script: make test-license
    - stage: tests
      script: make test-go
    - stage: "Test Images"
      script: make build-tf-images
      script: make build-spark-images && make test-python
      script: make build-argo-images
      script: make build-operator-images
    - stage: "Release"
      if: branch = master OR branch =~ /^[0-9]\.[0-9]$/
      script: make test-version
      script: make build-images && push-images
    - stage: "Deploy CLI"
      if: branch = master OR branch =~ /^[0-9]\.[0-9]$/
      script: make build-and-upload
    

