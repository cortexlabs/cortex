apiVersion: v1
kind: Service
metadata:
  annotations:
    autoscaling.cortex.dev/downscale-stabilization-period: 5m0s
    autoscaling.cortex.dev/downscale-tolerance: "0.05"
    autoscaling.cortex.dev/max-downscale-factor: "0.75"
    autoscaling.cortex.dev/max-replica-concurrency: "1024"
    autoscaling.cortex.dev/max-replicas: "100"
    autoscaling.cortex.dev/max-upscale-factor: "1.5"
    autoscaling.cortex.dev/min-replicas: "1"
    autoscaling.cortex.dev/target-replica-concurrency: "1.0"
    autoscaling.cortex.dev/upscale-stabilization-period: 1m0s
    autoscaling.cortex.dev/upscale-tolerance: "0.05"
    autoscaling.cortex.dev/window: 1m0s
    networking.cortex.dev/endpoint: /iris-classifier
    predictor.cortex.dev/processes-per-replica: "1"
    predictor.cortex.dev/threads-per-process: "1"
  creationTimestamp: "2021-03-19T14:21:30Z"
  labels:
    apiKind: RealtimeAPI
    apiName: iris-classifier
    cortex.dev/api: "true"
  name: api-iris-classifier
  namespace: default
spec:
  ports:
  - name: grpc-port
    port: 8888
    protocol: TCP
    targetPort: 8888
  selector:
    apiKind: RealtimeAPI
    apiName: iris-classifier
  sessionAffinity: None
  type: ClusterIP

---

apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  annotations:
    autoscaling.cortex.dev/downscale-stabilization-period: 5m0s
    autoscaling.cortex.dev/downscale-tolerance: "0.05"
    autoscaling.cortex.dev/max-downscale-factor: "0.75"
    autoscaling.cortex.dev/max-replica-concurrency: "1024"
    autoscaling.cortex.dev/max-replicas: "100"
    autoscaling.cortex.dev/max-upscale-factor: "1.5"
    autoscaling.cortex.dev/min-replicas: "1"
    autoscaling.cortex.dev/target-replica-concurrency: "1.0"
    autoscaling.cortex.dev/upscale-stabilization-period: 1m0s
    autoscaling.cortex.dev/upscale-tolerance: "0.05"
    autoscaling.cortex.dev/window: 1m0s
    networking.cortex.dev/endpoint: /iris-classifier
    predictor.cortex.dev/processes-per-replica: "1"
    predictor.cortex.dev/threads-per-process: "1"
  creationTimestamp: "2021-03-19T14:21:30Z"
  generation: 1
  labels:
    apiID: 69923bafd1b78fb6-nsblzudbiz-6acd2c8b3412cfc770418abbef7de487
    apiKind: RealtimeAPI
    apiName: iris-classifier
    cortex.dev/api: "true"
  name: api-iris-classifier
  namespace: default
spec:
  gateways:
  - apis-gateway
  hosts:
  - '*'
  http:
  - match:
    - uri:
        exact: /iris-classifier
    rewrite:
      uri: /
    route:
    - destination:
        host: api-iris-classifier
        port:
          number: 8888
      weight: 100

---