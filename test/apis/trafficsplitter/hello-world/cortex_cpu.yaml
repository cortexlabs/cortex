- name: hello-world-a
  kind: RealtimeAPI
  pod:
    port: 9000
    containers:
    - name: api
      image: 499593605069.dkr.ecr.us-west-2.amazonaws.com/cortexlabs-tests/trafficsplitter-hello-world-cpu:latest
      readiness_probe:
        http_get:
          path: "/healthz"
          port: 9000
      compute:
        cpu: 200m
        mem: 128M
  autoscaling:
    max_concurrency: 1

- name: hello-world-a
  kind: RealtimeAPI
  pod:
    port: 9000
    containers:
    - name: api
      image: 499593605069.dkr.ecr.us-west-2.amazonaws.com/cortexlabs-tests/trafficsplitter-hello-world-cpu:latest
      readiness_probe:
        http_get:
          path: "/healthz"
          port: 9000
      compute:
        cpu: 200m
        mem: 128M
  autoscaling:
    max_concurrency: 1

- name: request-recorder
  kind: RealtimeAPI
  pod:
    port: 9000
    containers:
    - name: api
      image: 499593605069.dkr.ecr.us-west-2.amazonaws.com/cortexlabs-tests/trafficsplitter-hello-world-cpu:latest
      env:
        RECORD_ONLY: "true"
      readiness_probe:
        http_get:
          path: "/healthz"
          port: 9000
      compute:
        cpu: 200m
        mem: 128M
  autoscaling:
    max_concurrency: 1

- name: hello-world
  kind: TrafficSplitter
  apis:
    - name: prime-generator-a
      weight: 30
    - name: prime-generator-b
      weight: 70
    - name: request-recorder
      shadow: true
      weight: 100
